<ion-header>
  <ion-navbar>
    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title>Chart</ion-title>
    <ion-buttons end>
      <button ion-button color="primary" (tap)="openSearch($event)">
        <ion-icon name="search"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
</ion-header>
<ion-content>
  <div padding>
    <ion-segment [(ngModel)]="chartType" (ionChange)="changeChartType()">
      <ion-segment-button value="byMoney">
        Chart by Month
      </ion-segment-button>
      <ion-segment-button value="byTypeSpending">
        Chart by spending type
      </ion-segment-button>
    </ion-segment>
  </div>
  <div [ngSwitch]="chartType">
    <div *ngSwitchCase="'byMoney'">
      <div style="position: relative; height: 200px;">
        <chart-line [data]="chartDataByMonth.chart" *ngIf="chartDataByMonth.chart" title="All month" (onPick)="pickMonthChart($event)"></chart-line>  
      </div>
      <ion-list *ngIf="chartDataByMonth.table">
        <ion-list-header>
          Statistic by month<br/>
          <small>{{toDate(filter.startDate) | date: 'dd MMM,yyyy'}} - {{toDate(filter.endDate) | date: 'dd MM,yyyy'}}</small>
        </ion-list-header>
        <button ion-item *ngFor="let item of chartDataByMonth.table" (tap)="gotoMonthChart(item)">
          <strong class="pull-right">
            <div class="earning"><small>+ {{(item.emoney || 0) | currency:'VND':true}}</small></div>
            <div class="spending"><small>- {{(item.smoney || 0) | currency:'VND':true}}</small></div>        
          </strong>
          <h2>{{item._id.month+1}}-{{item._id.year}}</h2>      
        </button>
      </ion-list>
    </div> 
    <div *ngSwitchCase="'byTypeSpending'">
      <div padding>
        <ion-segment [(ngModel)]="type" (ionChange)="loadChartByTypeSpending()">
          <ion-segment-button value="spending">
            Spending
          </ion-segment-button>
          <ion-segment-button value="earning">
            Earning
          </ion-segment-button>
        </ion-segment>
      </div>
      <div [ngSwitch]="type">
        <div *ngSwitchCase="'spending'" style="position: relative">
          <chart-pie title="spending" [data]="chartDataByType.chart.spending" *ngIf="chartDataByType.chart.spending"></chart-pie>
          <ion-list *ngIf="chartDataByType.table.spending">
            <ion-list-header>
              Statistic by type<br/>
              <small>{{toDate(filter.startDate) | date: 'dd MMM, yyyy'}} -  {{toDate(filter.endDate) | date: 'dd MMM, yyyy'}}</small>
              <strong item-right>{{chartDataByType.table.totalSpending | currency:'VND':true}}</strong>
            </ion-list-header>
            <button ion-item *ngFor="let item of chartDataByType.table.spending" (click)="gotoSpendingByType(item)">
              <strong item-right>
                <div class="spending">- {{(item.money || 0) | currency:'VND':true}}</div>        
              </strong>
              <h2>{{item.name}}</h2>      
            </button>
          </ion-list>
        </div>
        <div *ngSwitchCase="'earning'">
          <chart-pie title="earning" [data]="chartDataByType.chart.earning" *ngIf="chartDataByType.chart.earning"></chart-pie>
          <ion-list *ngIf="chartDataByType.table.earning">
            <ion-list-header>
              Statistic by type<br/>
              <small>{{toDate(filter.startDate) | date: 'dd MMM,yyyy'}} -  {{toDate(filter.endDate) | date: 'dd MM,yyyy'}}</small>
              <strong item-right>{{chartDataByType.table.totalEarning | currency:'VND':true}}</strong>
            </ion-list-header>
            <button ion-item *ngFor="let item of chartDataByType.table.earning" (click)="gotoSpendingByType(item)">
              <strong item-right>
                <div class="earning">+ {{(item.money || 0) | currency:'VND':true}}</div>
              </strong>
              <h2>{{item.name}}</h2>      
            </button>
          </ion-list>
        </div>
      </div>  
    </div>
  </div>  
</ion-content>
